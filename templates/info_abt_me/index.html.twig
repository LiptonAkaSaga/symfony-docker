{% extends 'base.html.twig' %}

{% block title %}My Page{% endblock %}

{% block body %}
    <h1>O mnie</h1>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success">
            {{ message }}
        </div>
    {% endfor %}

    {% for message in app.flashes('warning') %}
        <div class="alert alert-warning">
            {{ message }}
        </div>
    {% endfor %}

    <p>Łączna liczba informacji: {{ totalEntries }}</p>

    <a href="{{ path('app_about_me_new') }}" class="btn btn-primary mb-3">Dodaj nową informację</a>

    <form action="{{ path('app_about_me_delete_multiple') }}" method="post" id="delete-multiple-form">
        <table class="table">
            <thead>
            <tr>
                <th><input type="checkbox" id="select-all"></th>
                <th>Klucz</th>
                <th>Wartość</th>
                <th>Akcje</th>
            </tr>
            </thead>
            <tbody>
            {% for info in aboutMeInfo %}
                <tr>
                    <td><input type="checkbox" name="delete_ids[]" value="{{ info.id }}" class="delete-checkbox"></td>
                    <td>{{ info.infoKey }}</td>
                    <td>{{ info.value }}</td>
                    <td>
                        <a href="{{ info.editLink }}" class="btn btn-sm btn-primary">Edytuj</a>
                        <form method="post" action="{{ info.deleteLink }}" style="display: inline-block" onsubmit="return confirm('Czy na pewno chcesz usunąć tę informację?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ info.id) }}">
                            <button type="submit" class="btn btn-sm btn-danger">Usuń</button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4">Brak informacji do wyświetlenia.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <button type="submit" class="btn btn-danger" id="delete-selected">Usuń zaznaczone</button>
    </form>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var selectAllCheckbox = document.getElementById('select-all');
            var deleteCheckboxes = document.getElementsByClassName('delete-checkbox');

            selectAllCheckbox.addEventListener('change', function() {
                for (var i = 0; i < deleteCheckboxes.length; i++) {
                    deleteCheckboxes[i].checked = this.checked;
                }
            });

            document.getElementById('delete-selected').addEventListener('click', function(event) {
                event.preventDefault();
                var checkedBoxes = document.querySelectorAll('.delete-checkbox:checked');
                if (checkedBoxes.length > 0) {
                    if (confirm('Czy na pewno chcesz usunąć zaznaczone informacje?')) {
                        document.getElementById('delete-multiple-form').submit();
                    }
                } else {
                    alert('Proszę zaznaczyć przynajmniej jedną informację do usunięcia.');
                }
            });

            // Aktualizacja stanu "select-all" checkbox
            for (var i = 0; i < deleteCheckboxes.length; i++) {
                deleteCheckboxes[i].addEventListener('change', function() {
                    selectAllCheckbox.checked = Array.from(deleteCheckboxes).every(function(checkbox) {
                        return checkbox.checked;
                    });
                });
            }
        });
    </script>
{% endblock %}
